# è¯„è®ºå‘å¸ƒåŠŸèƒ½ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

postDetail.vue ä¸­çš„è¯„è®ºå‘å¸ƒåŠŸèƒ½æœ‰é—®é¢˜ï¼Œéœ€è¦å‚è€ƒ CommentPopup ç»„ä»¶ä¸­çš„å®ç°è¿›è¡Œä¿®å¤ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. å‚æ•°ç±»å‹ä¸åŒ¹é…

#### CommentInput ç»„ä»¶å‘é€çš„æ•°æ®æ ¼å¼
```typescript
// CommentInput.vue ä¸­çš„ handleSubmit å‡½æ•°
emit('submit', {
    content: commentText.value,
    isAnonymous: isAnonymous.value
})
```

#### postDetail.vue åŸæ¥çš„æ¥æ”¶æ ¼å¼
```typescript
// é”™è¯¯çš„å‚æ•°ç±»å‹
const handleCommentSubmit = async (content: string) => {
    // åªæ¥æ”¶å­—ç¬¦ä¸²ï¼Œæ— æ³•å¤„ç†åŒ¿åæ ‡è¯†
}
```

### 2. CommentPopup ä¸­çš„æ­£ç¡®å®ç°
```typescript
// CommentPopup.vue ä¸­çš„æ­£ç¡®å®ç°
async function handleSubmit(data: { content: string; isAnonymous: boolean }) {
    if (!props.postInfo?.id) return
    
    try {
        uni.showLoading({ title: 'å‘å¸ƒä¸­...', mask: true })
        
        const params = {
            postId: props.postInfo.id,
            content: data.content.trim(),
            parentId: replyInfo.value.parentId || undefined,
            replyUserId: replyInfo.value.replyUserId || undefined
        }
        
        const response = await postCommentApi.addComment(params)
        // ... å¤„ç†å“åº”
    } catch (error) {
        // ... é”™è¯¯å¤„ç†
    }
}
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ­£å‚æ•°ç±»å‹

```typescript
// ä¿®å¤åçš„ handleCommentSubmit å‡½æ•°
const handleCommentSubmit = async (data: { content: string; isAnonymous: boolean }) => {
    if (!postId.value) return
    
    try {
        uni.showLoading({ title: 'å‘å¸ƒä¸­...', mask: true })

        const params = {
            postId: postId.value,
            content: data.content.trim(),
            // å¦‚æœæ˜¯å›å¤è¯„è®ºï¼Œä½¿ç”¨ parentId
            parentId: replyInfo.value.parentId || undefined,
            // å¦‚æœæ˜¯å›å¤è¯„è®ºï¼Œä½¿ç”¨è¢«å›å¤ç”¨æˆ·çš„ ID
            replyUserId: replyInfo.value.replyId || undefined
        }

        const response = await postCommentApi.addComment(params)

        if (response.code === 0) {
            uni.hideLoading()
            uni.showToast({
                title: 'å‘å¸ƒæˆåŠŸ',
                icon: 'success'
            })

            hideCommentInput()
            // åˆ·æ–°è¯„è®ºåˆ—è¡¨
            await loadComments()
        }
    } catch (error) {
        console.error('å‘å¸ƒè¯„è®ºå¤±è´¥:', error)
        uni.hideLoading()
        uni.showToast({
            title: 'å‘å¸ƒå¤±è´¥',
            icon: 'none'
        })
    }
}
```

### 2. æ•°æ®æµç¨‹å›¾

```
CommentInput ç»„ä»¶
    â†“ @click="handleSubmit"
å‘é€æŒ‰é’®ç‚¹å‡»
    â†“ emit('submit', { content, isAnonymous })
å‘é€æ•°æ®åˆ°çˆ¶ç»„ä»¶
    â†“ @submit="handleCommentSubmit"
postDetail.vue æ¥æ”¶
    â†“ handleCommentSubmit(data)
å¤„ç†è¯„è®ºæäº¤
    â†“ postCommentApi.addComment(params)
è°ƒç”¨ API å‘å¸ƒè¯„è®º
    â†“ loadComments()
åˆ·æ–°è¯„è®ºåˆ—è¡¨
```

## ğŸ¯ å…³é”®æ”¹è¿›

### 1. å‚æ•°ç±»å‹åŒ¹é…
- **ä¿®å¤å‰**: åªæ¥æ”¶ `content: string`
- **ä¿®å¤å**: æ¥æ”¶ `{ content: string; isAnonymous: boolean }`

### 2. æ•°æ®éªŒè¯
- æ·»åŠ äº† `postId.value` çš„éªŒè¯
- ç¡®ä¿å†…å®¹ä¸ä¸ºç©ºå†æäº¤

### 3. å›å¤é€»è¾‘
- æ­£ç¡®å¤„ç† `parentId`ï¼ˆçˆ¶è¯„è®º IDï¼‰
- æ­£ç¡®å¤„ç† `replyUserId`ï¼ˆè¢«å›å¤ç”¨æˆ· IDï¼‰

### 4. é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„åŠ è½½çŠ¶æ€ç®¡ç†
- å®Œå–„çš„é”™è¯¯æç¤º

## ğŸ“± ä½¿ç”¨æµç¨‹

### 1. æ™®é€šè¯„è®º
1. ç”¨æˆ·ç‚¹å‡»"å†™è¯„è®º"æŒ‰é’®
2. CommentInput å¼¹å‡ºï¼Œç”¨æˆ·è¾“å…¥å†…å®¹
3. ç‚¹å‡»å‘é€æŒ‰é’®
4. è°ƒç”¨ `handleCommentSubmit({ content: "è¯„è®ºå†…å®¹", isAnonymous: false })`
5. API è°ƒç”¨æˆåŠŸååˆ·æ–°è¯„è®ºåˆ—è¡¨

### 2. å›å¤è¯„è®º
1. ç”¨æˆ·ç‚¹å‡»æŸæ¡è¯„è®ºçš„å›å¤æŒ‰é’®
2. è®¾ç½® `replyInfo` ä¿¡æ¯
3. CommentInput å¼¹å‡ºï¼Œæ˜¾ç¤ºå›å¤ç›®æ ‡
4. ç”¨æˆ·è¾“å…¥å›å¤å†…å®¹
5. ç‚¹å‡»å‘é€æŒ‰é’®
6. è°ƒç”¨ `handleCommentSubmit` æ—¶ä¼šåŒ…å« `parentId` å’Œ `replyUserId`

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### 1. API å‚æ•°ç»“æ„
```typescript
interface AddCommentParams {
    postId: string;           // å¸–å­ ID
    content: string;          // è¯„è®ºå†…å®¹
    parentId?: string;        // çˆ¶è¯„è®º IDï¼ˆå›å¤æ—¶ä½¿ç”¨ï¼‰
    replyUserId?: string;     // è¢«å›å¤ç”¨æˆ· IDï¼ˆå›å¤æ—¶ä½¿ç”¨ï¼‰
}
```

### 2. å›å¤ä¿¡æ¯ç»“æ„
```typescript
interface ReplyInfo {
    isReply: boolean;         // æ˜¯å¦æ˜¯å›å¤
    parentId: string;         // çˆ¶è¯„è®º ID
    replyId: string;          // è¢«å›å¤ç”¨æˆ· ID
    targetUser: string;       // è¢«å›å¤ç”¨æˆ·å
}
```

### 3. ç»„ä»¶äº‹ä»¶
```typescript
// CommentInput ç»„ä»¶å‘é€çš„äº‹ä»¶
interface SubmitEvent {
    content: string;          // è¯„è®ºå†…å®¹
    isAnonymous: boolean;     // æ˜¯å¦åŒ¿å
}
```

## ğŸš€ æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•
- âœ… å‘å¸ƒæ™®é€šè¯„è®º
- âœ… å›å¤è¯„è®º
- âœ… åŒ¿åè¯„è®ºåŠŸèƒ½
- âœ… è¯„è®ºåˆ—è¡¨åˆ·æ–°

### 2. é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… ç½‘ç»œé”™è¯¯æç¤º
- âœ… ç©ºå†…å®¹éªŒè¯
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤º

### 3. ç”¨æˆ·ä½“éªŒæµ‹è¯•
- âœ… å‘å¸ƒæˆåŠŸæç¤º
- âœ… è‡ªåŠ¨å…³é—­è¾“å…¥æ¡†
- âœ… è¯„è®ºåˆ—è¡¨å®æ—¶æ›´æ–°

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- å‚æ•°ç±»å‹ä¸åŒ¹é…å¯¼è‡´å‘å¸ƒå¤±è´¥
- æ— æ³•å¤„ç†åŒ¿åè¯„è®ºåŠŸèƒ½
- å›å¤é€»è¾‘å¯èƒ½æœ‰é—®é¢˜

### ä¿®å¤å
- å‚æ•°ç±»å‹å®Œå…¨åŒ¹é…
- æ”¯æŒåŒ¿åè¯„è®ºåŠŸèƒ½
- å›å¤é€»è¾‘æ­£ç¡®å¤„ç†
- ä¸ CommentPopup ä¿æŒä¸€è‡´

ç°åœ¨ postDetail.vue ä¸­çš„è¯„è®ºå‘å¸ƒåŠŸèƒ½å·²ç»ä¿®å¤ï¼Œä¸ CommentPopup ä¸­çš„å®ç°ä¿æŒä¸€è‡´ï¼
